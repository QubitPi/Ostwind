<!doctype html><html><!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta content="IE=edge" http-equiv=x-ua-compatible>
<meta content="width=device-width,initial-scale=1" name=viewport>
<meta content name=description>
<meta content name=author>
<title>Basic Dependency Injection using Jersey's HK2</title>
<link href=/favicon.ico rel=icon>
<link href=https://ostwind.qubitpi.org/css/font-awesome.all.min.css rel=stylesheet>
<link href=https://ostwind.qubitpi.org/css/bootstrap.min.css rel=stylesheet>
<link href=https://ostwind.qubitpi.org/css/termynal.css rel=stylesheet>
<link href=https://ostwind.qubitpi.org/css/ostwind-theme.css rel=stylesheet>
<meta content="#da532c" name=msapplication-TileColor>
<meta content="#ffffff" name=theme-color>
</head>
<body>
<body>
<header>
<menu style=background:#000;margin:0>
<nav class="navbar navbar-expand-lg navbar-dark bg-black">
<div class=container-fluid>
<a href=https://ostwind.qubitpi.org> <img alt=Ostwind height=35 src=https://ostwind.qubitpi.org/images/logo.svg width=60></a>
<a class="header-text navbar-brand" href=https://ostwind.qubitpi.org>Ostwind</a>
<button aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation" class=navbar-toggler data-bs-target=#navbarSupportedContent data-bs-toggle=collapse type=button>
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item dropdown">
<a aria-expanded=false class="nav-link dropdown-toggle" data-bs-toggle=dropdown href=/Document id=navbarDropdown role=button>
Documentation
</a>
<ul aria-labelledby=navbarDropdown class=dropdown-menu>
<li><a class=dropdown-item href=/docs/intro>Getting Started</a></li>
<li><a class=dropdown-item href=/docs/json-api>JSON API</a></li>
<li><a class=dropdown-item href=/docs/graphql>GraphQL</a></li>
<li><a class=dropdown-item href=/docs/filestore>File Stores</a></li>
<li><a class=dropdown-item href=/docs/configuration>Configuration</a></li>
<li><a class=dropdown-item href=/docs/system-config>System Configuration</a></li>
<li><a class=dropdown-item href=/docs/monitoring-and-operations>Monitoring and Operations</a></li>
<li><a class=dropdown-item href=/docs/logging>Logging Guidelines</a></li>
<li><a class=dropdown-item href=/docs/kpi>Key Performance Indicators</a></li>
<li>
<hr class=dropdown-divider>
</li>
<li><a class=dropdown-item href=/docs/glossary>Glossary</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a aria-expanded=false class=nav-link href=https://ostwind.qubitpi.org/apidocs/ id=navbarDropdown role=button>
API
</a>
</li>
<li class="nav-item dropdown">
<a aria-expanded=false class=nav-link href=/general/downloads id=navbarDropdown role=button>
Releases
</a>
</li>
<li class="nav-item dropdown">
<a aria-expanded=false class="nav-link dropdown-toggle" data-bs-toggle=dropdown href=# id=navbarDropdown role=button>
Contributor Guide
</a>
<ul aria-labelledby=navbarDropdown class=dropdown-menu>
<li><a class=dropdown-item href=https://ostwind.qubitpi.org/development/intro/>Getting Started</a></li>
<li><a class=dropdown-item href=https://ostwind.qubitpi.org/development/di/>Dependency Injection</a></li>
<li><a class=dropdown-item href=https://ostwind.qubitpi.org/development/test/>Testing</a></li>
<li><a class=dropdown-item href=https://ostwind.qubitpi.org/development/metastore/>Meta Stores</a></li>
<li><a class=dropdown-item href=https://ostwind.qubitpi.org/development/local-swift/>Swift (Local)</a></li>
</ul>
</li>
<li class="nav-item dropdown">
<a aria-expanded=false class="nav-link dropdown-toggle" data-bs-toggle=dropdown href=# id=navbarDropdown role=button>
Blogs
</a>
<ul aria-labelledby=navbarDropdown class=dropdown-menu>
<li><a class=dropdown-item href=https://ostwind.qubitpi.org/blog/yahoo-object-storage/>Yahoo
Cloud Object Store</a></li>
</ul>
</li>
<li>
<form action=/search class=search-bar method=get>
<input class=search-input id=search-query name=q placeholder=Search... type=search>
<button class=search-button type=submit>Search</button>
</form>
</li>
</ul>
</div>
</div>
</nav>
</menu>
</header>
<div class=content>
<div class=docs>
<p>Jersey uses <a href=https://qubitpi.github.io/glassfish-hk2/>HK2</a> as its dependency injection (DI) system. We can use other
injection systems, but its infrastructure is built with HK2, and allows us to also use it within our applications.</p>
<p>Setting up simple dependency injection with Jersey takes just a few lines of code. Let say for example we have a service
we would like to inject into our resources.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GreetingService</span> <span style=color:#f92672>{</span>

    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getGreeting</span><span style=color:#f92672>(</span>String name<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Hello &#34;</span> <span style=color:#f92672>+</span> name <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;!&#34;</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>And we want to inject this service into a Jersey resource</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Path</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;greeting&#34;</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GreetingResource</span> <span style=color:#f92672>{</span>

    <span style=color:#a6e22e>@Inject</span>
    <span style=color:#66d9ef>public</span> GreetingService greetingService<span style=color:#f92672>;</span>

    <span style=color:#a6e22e>@GET</span>
    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@QueryParam</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>)</span> String name<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>greetingService</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getGreeting</span><span style=color:#f92672>(</span>name<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>In order for the injection to work, all we need is a simple configuration</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@ApplicationPath</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api&#34;</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppConfig</span> <span style=color:#66d9ef>extends</span> ResourceConfig <span style=color:#f92672>{</span>

    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>AppConfig</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        register<span style=color:#f92672>(</span>GreetingResource<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
        register<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> AbstractBinder<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
            <span style=color:#a6e22e>@Override</span>
            <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
                bindAsContract<span style=color:#f92672>(</span>GreetingService<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>});</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Here we are saying that we want to bind the <code>GreetingService</code> to the injection system, and advertise it as injectable by
the same class. What the last statement means is that we can only inject it as <code>GreetingService</code> and (probably
obviously) not by any other class. As you will see later, it is possible to change this.</p>
<blockquote>
<p>Note: The injection above is field injection, where the service is injected into the field of the resource. Another
type of injection is constructor injection, where the service is injected into the constructor. Ostwind uses
constructor injection ubiquitously. An example of the constructor injection is shown below:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> GreetingService greetingService<span style=color:#f92672>;</span>

<span style=color:#a6e22e>@Inject</span>
<span style=color:#66d9ef>public</span> <span style=color:#a6e22e>GreetingResource</span><span style=color:#f92672>(</span>GreetingService greetingService<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>greetingService</span> <span style=color:#f92672>=</span> greetingService<span style=color:#f92672>;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Ostwind chooses constructor injection as opposed to field injection, as it <em>makes the resource easier to unit test</em>.
Constructor injection doesn&rsquo;t require any different configuration.</p>
</blockquote>
<p>Lets say that instead of a class, the <code>GreetingService</code> is an interface, and we have an implementation of it (which is
very common). To configure that, we would use the following syntax in the above <code>configure</code> method</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Override</span>
<span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    bind<span style=color:#f92672>(</span>NiceGreetingService<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>).</span><span style=color:#a6e22e>to</span><span style=color:#f92672>(</span>GreetingService<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>This reads as &ldquo;bind <code>NiceGreetingService</code>, and advertise it as <code>GreetingService</code>&rdquo;. This means we can use the exact same
code in the <code>GreetingResource</code> above, because we advertise the contract as <code>GreetingService</code> and not
<code>NiceGreetingService</code>. But the actual implementation, when injected, will be the <code>NiceGreetingService</code>.</p>
<p>If you&rsquo;ve ever worked with any injection framework, you will have came across the concept of <strong>scope</strong>, which determines
the lifespan of the service. You may have heard of a &ldquo;Request Scope&rdquo;, where the service is alive only for the life of the
request. Or a &ldquo;Singleton Scope&rdquo;, where there is only one instance of the service. We can configure these scopes also
using the following syntax.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Override</span>
<span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    bind<span style=color:#f92672>(</span>NiceGreetingService<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>to</span><span style=color:#f92672>(</span>GreetingService<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>in</span><span style=color:#f92672>(</span>RequestScoped<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>The default scope is <strong><code>PerLookup</code></strong>, which means that every time this service is requested, a new one will be created.
In the example above, using the <strong><code>RequestScoped</code></strong>, a new service will be created for a single request. This may or may
not be the same as the <code>PerLookup</code>, depending on how many places we are trying to inject it. We may be trying to inject
it into a filter and into a resource. If this were <code>PerLookup</code>, then two instances would be created for each request. In
this case, we only want one.</p>
<p>The other two scopes available are <strong><code>Singleton</code></strong> (only one instance created) and <strong><code>Immediate</code></strong> (like Singleton) but is
created on startup (whereas with <code>Singleton</code>, it&rsquo;s not created until the first request).</p>
<p>Aside from binding classes, we could also just use an instance. This would gives us a <em>default singleton</em>, so we don&rsquo;t
need to use the <code>in</code> syntax.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Override</span>
<span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    bind<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> NiceGreetingService<span style=color:#f92672>())</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>to</span><span style=color:#f92672>(</span>GreetingService<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>What if we have some complex creation logic or need some request context information for the service. In this case there
are Factorys. For example</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GreetingServiceFactory</span> <span style=color:#66d9ef>implements</span> Factory<span style=color:#f92672>&lt;</span>GreetingService<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>

    <span style=color:#a6e22e>@Context</span>
    UriInfo uriInfo<span style=color:#f92672>;</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> GreetingService <span style=color:#a6e22e>provide</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> GreetingService<span style=color:#f92672>(</span>
                uriInfo<span style=color:#f92672>.</span><span style=color:#a6e22e>getQueryParameters</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getFirst</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>));</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>dispose</span><span style=color:#f92672>(</span>GreetingService service<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#75715e>/* noop */</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Here we have a factory, that gets request information from the <code>UriInfo</code>, in this case a query parameters, and we create
the <code>GreetingService</code> from it. To configure it, we use the following syntax</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Override</span>
<span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    bindFactory<span style=color:#f92672>(</span>GreetingServiceFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>to</span><span style=color:#f92672>(</span>GreetingService<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>in</span><span style=color:#f92672>(</span>RequestScoped<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>
</code></pre></div>
</div>
</div>
<footer class="black-background static-bottom" style=padding:30px>
<div class=row>
<div class=col-3>
<a href=https://qubitpi.org/>
<img alt=QubitPi height=100% src=https://ostwind.qubitpi.org/images/logo.png width=100></a>
</a>
</div>
<div class=col-9>
<p class=footer-text>
My sincere thanks to <a href=https://github.com/yahoo/fili>yahoo/fili</a> &
        <a href=https://github.com/yahoo/elide>yahoo/elide</a>, which
gave tremendous amount of guidance on design and development of
<a href=https://ostwind.qubitpi.org/>Ostwind</a>, and to my former employer, Yahoo, who taught me to love
software engineering and fundamentally influenced my tech career.
</p>
</div>
</div>
<div class="copyright row">
<a href=https://ostwind.qubitpi.org style=color:grey>
The contents of this website are © 2025 Ostwind (Jiaqi Liu) under the terms of the Apache License v2.
</a>
</div>
</footer>
<script src=https://ostwind.qubitpi.org/js/bootstrap.bundle.min.js></script>
</body>
</html>